# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–º–∞–Ω–¥—ã /edit –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É Service Object

## üìã –û–±–∑–æ—Ä

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã `/edit` —Å —Ü–µ–ª—å—é —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —á–µ—Ä–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–ª–∞—Å—Å—ã.

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- 180+ —Å—Ç—Ä–æ–∫ edit-–ª–æ–≥–∏–∫–∏ –≤ `TelegramCallbacks`
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–¶–µ–ª—å:** –°–æ–∫—Ä–∞—Ç–∏—Ç—å `TelegramCallbacks` –Ω–∞ ~150 —Å—Ç—Ä–æ–∫ –∏ —Å–æ–∑–¥–∞—Ç—å —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## ‚úÖ TODO-–ª–∏—Å—Ç –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

### üèóÔ∏è –§–∞–∑–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

- [ ] **–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤**
  ```
  app/services/telegram/
  ‚îú‚îÄ‚îÄ edit/
  ‚îÇ   ‚îú‚îÄ‚îÄ pagination_service.rb
  ‚îÇ   ‚îú‚îÄ‚îÄ table_formatter.rb
  ‚îÇ   ‚îî‚îÄ‚îÄ time_shift_service.rb
  ‚îî‚îÄ‚îÄ concerns/
      ‚îî‚îÄ‚îÄ pagination_concern.rb
  ```

- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram::Edit::PaginationService**
  - –õ–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–µ–π
  - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Å–µ—Å—Å–∏–∏

- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram::Edit::TableFormatter**
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `Terminal::Table`
  - –¢—Ä–µ–∫–∏–Ω–≥ –æ–ø–∏—Å–∞–Ω–∏–π
  - –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram::Edit::TimeShiftService**
  - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `TelegramSession`
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- [ ] **–°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π Telegram::PaginationConcern**
  - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  - –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### üîÑ –§–∞–∑–∞ 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

- [ ] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ EditCommand –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤**
  - –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã
  - –£–ø—Ä–æ—Å—Ç–∏—Ç—å –º–µ—Ç–æ–¥ `show_time_shifts_list`
  - –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `TableFormatter`
  - –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

- [ ] **–£–¥–∞–ª–∏—Ç—å edit-–º–µ—Ç–æ–¥—ã –∏–∑ TelegramCallbacks**
  - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ `TimeShiftService`
  - –£–¥–∞–ª–∏—Ç—å 11 edit-–º–µ—Ç–æ–¥–æ–≤ (~180 —Å—Ç—Ä–æ–∫)
  - –û–±–Ω–æ–≤–∏—Ç—å `callback_query` –¥–ª—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ callback-–º–µ—Ç–æ–¥—ã

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å TelegramSessionHelpers –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏**
  - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `edit_time_shift` –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
  - –û–±–Ω–æ–≤–∏—Ç—å `build_changes_text`
  - –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å `handle_missing_time_shift`
  - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Å–µ—Å—Å–∏–µ–π

### üß™ –§–∞–∑–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] **–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
  - `spec/services/telegram/edit/pagination_service_spec.rb`
  - `spec/services/telegram/edit/table_formatter_spec.rb`
  - `spec/services/telegram/edit/time_shift_service_spec.rb`
  - –ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã**
  - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `edit_command_spec.rb`
  - –û–±–Ω–æ–≤–∏—Ç—å `telegram_callbacks_spec.rb`
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
  - –£–±–µ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö flow

### üìù –§–∞–∑–∞ 4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
  - –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏

- [ ] **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
  - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

---

## üèÅ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ `TelegramCallbacks`: —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Å 180+ –¥–æ ~30 —Å—Ç—Ä–æ–∫
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ ~150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ 4 –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤-—Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >90%
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –≤—ã–≥–æ–¥—ã:
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç Telegram API
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## üöÄ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é `EditCommand` –≤ `edit_command_backup.rb`
2. –°–¥–µ–ª–∞—Ç—å backup `TelegramCallbacks` –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –º–µ—Ç–æ–¥–æ–≤
3. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ git
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ–∞–∑—É –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –í—Å–µ —Ç–µ–∫—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ `/edit` —Ä–∞–±–æ—Ç–∞—é—Ç
2. **–ö–æ–¥:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –∫–æ–¥–∞ –º–∏–Ω–∏–º—É–º –Ω–∞ 100 —Å—Ç—Ä–æ–∫
3. **–¢–µ—Å—Ç—ã:** –ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ >90%
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–µ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏