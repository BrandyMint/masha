# –ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö Telegram –∫–æ–º–∞–Ω–¥

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `spec/controllers/telegram/webhook/`
**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:** `{command_name}_command_spec.rb`
**–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É `start_command_spec.rb`

## –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∏ —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤ (21 –∫–æ–º–∞–Ω–¥–∞)

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Priority 1)
1. `help_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/help`
2. `version_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/version`
3. `reset_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/reset`
4. `projects_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/projects`
5. `add_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/add`

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏ (Priority 2)
6. `edit_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/edit`
7. `new_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/new`
8. `rename_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/rename`
9. `attach_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/attach`

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (Priority 3)
10. `adduser_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/adduser`
11. `users_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/users`
12. `merge_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/merge`

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (Priority 3)
13. `rate_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/rate`
14. `client_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/client`

### –û—Ç—á–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Priority 2)
15. `report_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/report`
16. `day_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/day`
17. `summary_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/summary`
18. `hours_command_spec.rb` - –∫–æ–º–∞–Ω–¥–∞ `/hours`

## –®–∞–±–ª–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

```ruby
# frozen_string_literal: true

require 'spec_helper'

RSpec.describe Telegram::WebhookController, telegram_bot: :rails, type: :telegram_bot_controller do
  include_context 'telegram webhook base'

  context 'authenticated user' do
    let(:user) { create(:user, :with_telegram) }
    let(:telegram_user) { user.telegram_user }
    let(:from_id) { telegram_user.id }

    include_context 'authenticated user'

    it 'responds to /{command} command without errors' do
      expect { dispatch_command :{command} }.not_to raise_error
    end
  end
end
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –ö–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:
- **/projects, /day, /summary, /hours**: –°–æ–∑–¥–∞—Ç—å test –ø—Ä–æ–µ–∫—Ç—ã –∏ –∑–∞–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–∏
- **/edit**: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **/adduser**: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **/rate**: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∞–≤–æ–∫

### –ö–æ–º–∞–Ω–¥—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞:
- **/merge, /users**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å developer telegram_id
- **/rename, /adduser**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ owner vs member

## –ü–æ—Ä—è–¥–æ–∫ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Ñ–∞–∑—ã)

### Phase 1: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (5 —Ñ–∞–π–ª–æ–≤)
1. `help_command_spec.rb`
2. `version_command_spec.rb`
3. `reset_command_spec.rb`
4. `projects_command_spec.rb`
5. `add_command_spec.rb`

### Phase 2: –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (5 —Ñ–∞–π–ª–æ–≤)
6. `edit_command_spec.rb`
7. `new_command_spec.rb`
8. `rename_command_spec.rb`
9. `attach_command_spec.rb`
10. `adduser_command_spec.rb`

### Phase 3: –û—Ç—á–µ—Ç—ã –∏ —Ñ–∏–Ω–∞–Ω—Å—ã (6 —Ñ–∞–π–ª–æ–≤)
11. `report_command_spec.rb`
12. `day_command_spec.rb`
13. `summary_command_spec.rb`
14. `hours_command_spec.rb`
15. `rate_command_spec.rb`
16. `client_command_spec.rb`

### Phase 4: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã (5 —Ñ–∞–π–ª–æ–≤)
17. `users_command_spec.rb` ‚úÖ
18. `merge_command_spec.rb` ‚úÖ

## –ò—Ç–æ–≥: 21 —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞:
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (–±–µ–∑ exception)
- ‚úÖ –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç nil/–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- Fixed fixture `:with_telegram` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Shared contexts –∏–∑ `telegram_webhook_shared.rb`
- `dispatch_command` –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ webhook –∑–∞–ø—Ä–æ—Å–æ–≤

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Phase 1: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)
- [x] `start_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `help_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `version_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `reset_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `projects_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `add_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≥—Ä–µ—Å—Å: 19/21 (90.5%)**

### Phase 2: –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)
- [x] `edit_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `new_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `rename_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `attach_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `adduser_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Phase 3: –û—Ç—á–µ—Ç—ã –∏ —Ñ–∏–Ω–∞–Ω—Å—ã (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)
- [x] `report_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `day_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `summary_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `hours_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `rate_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `client_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Phase 4: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)
- [x] `users_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] `merge_command_spec.rb` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### ‚úÖ –í—Å–µ —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:
- **Phase 1**: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (6 —Ç–µ—Å—Ç–æ–≤) ‚úÖ
- **Phase 2**: –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (5 —Ç–µ—Å—Ç–æ–≤) ‚úÖ
- **Phase 3**: –û—Ç—á–µ—Ç—ã –∏ —Ñ–∏–Ω–∞–Ω—Å—ã (6 —Ç–µ—Å—Ç–æ–≤) ‚úÖ
- **Phase 4**: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã (2 —Ç–µ—Å—Ç–∞) ‚úÖ

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤:
- **–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ**: 21 —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤**: 110 —Ç–µ—Å—Ç–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: 110 examples, 0 failures ‚úÖ
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –í—Å–µ Telegram –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

### üß™ –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (–±–µ–∑ exception)
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ-nil –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å–ª–µ–¥—É—é—Ç –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏ (owner/member/viewer)
- ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ –û—Ç—á–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### üèóÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- Fixed fixture `:with_telegram` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Shared contexts –∏–∑ `telegram_webhook_shared.rb`
- `dispatch_command` –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ webhook –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ membership —Å–∏—Å—Ç–µ–º–∞
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ edge cases

**üéâ –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Telegram –∫–æ–º–∞–Ω–¥ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù!**

**–ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å: 21/21 (100%) ‚úÖ**