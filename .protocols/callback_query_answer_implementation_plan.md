# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è answer_callback_query –≤ –ø—Ä–æ–µ–∫—Ç Mashtime.ru

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-15
**–ê–≤—Ç–æ—Ä:** AI Assistant
**–¢–∏–ø:** –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
**–°—Ç–∞—Ç—É—Å:** –ß–µ—Ä–Ω–æ–≤–∏–∫
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (High Priority)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –í –ø—Ä–æ–µ–∫—Ç–µ **26 callback_query –º–µ—Ç–æ–¥–æ–≤** –≤ —Ñ–∞–π–ª–∞—Ö `app/commands/*`
  - `projects_command.rb`: 14 –º–µ—Ç–æ–¥–æ–≤
  - `report_command.rb`: 5 –º–µ—Ç–æ–¥–æ–≤
  - `edit_command.rb`: 3 –º–µ—Ç–æ–¥–∞
  - `users_command.rb`: 3 –º–µ—Ç–æ–¥–∞
  - `add_command.rb`: 1 –º–µ—Ç–æ–¥
- **–ù–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Ç–æ–¥–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `answer_callback_query()`**

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç inline-–∫–Ω–æ–ø–∫—É, –æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "—á–∞—Å–∏–∫–∏" –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ **30 —Å–µ–∫—É–Ω–¥**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–∂–∞—Ç–∏—è
- –ü–ª–æ—Ö–æ–π UX, –±–æ—Ç –∫–∞–∂–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–º/–Ω–µ–æ—Ç–∑—ã–≤—á–∏–≤—ã–º
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Telegram API (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π)

### –¶–µ–ª–∏ –ø–ª–∞–Ω–∞
1. ‚úÖ –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç + —Ä—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
2. ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: –æ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –∫ —è–≤–Ω—ã–º –≤—ã–∑–æ–≤–∞–º
3. ‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ callback'–∏ –æ—Ç–≤–µ—á–∞—é—Ç
4. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏: –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–ª–∏–∑

---

## 2. –≠—Ç–∞–ø 1: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (Safety Net)

### 2.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ BaseCommand

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `app/commands/base_command.rb`

```ruby
class BaseCommand
  # frozen_string_literal: true
  include FormatHelpers

  NOTIFY_MESSAGE_INPUT = :notify_message_input

  # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã) ...

  # –ù–û–í–û–ï: –§–ª–∞–≥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ callback
  attr_accessor :callback_answered

  def safe_call(*args)
    Rails.logger.info "#{self.class}.call with args #{args}"

    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è developer_only –∫–æ–º–∞–Ω–¥
    return respond_with :message, text: I18n.t('telegram.errors.developer_access_denied') if self.class.developer_only? && !developer?

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–ª–∞–≥–∞ –¥–ª—è safety net
    @callback_answered = false

    result = call(*args)

    # –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ–º
    ensure_callback_answered

    result
  rescue StandardError => e
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ callback –ø—Ä–∏ –æ—à–∏–±–∫–µ
    auto_answer_callback_query if in_callback_context? && !@callback_answered
    raise
  end

  # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã) ...

  protected

  # –ù–û–í–û–ï: –ú–µ—Ç–æ–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ answer_callback_query —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
  def safe_answer_callback_query(text = )
    return unless in_callback_context?
    answer_callback_query text
  rescue StandardError => e
    Rails.logger.error "Failed to answer callback query: #{e.message}"
    Bugsnag.notify(e)
  end

  # –ù–û–í–û–ï: –ú–µ—Ç–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (safety net)
  def auto_answer_callback_query
    answer_callback_query( '‚úÖ' )
  rescue StandardError => e
    Rails.logger.error "Failed auto-answer callback query: #{e.message}"
    Bugsnag.notify(e)
  end

  private

  def answer_callback_query(text - nil)
    @callback_answered = true
    controller.answer_callback_query text
  end

  # –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  def in_callback_context?
    controller.payload.key?('callback_query')
  end

  # –ù–û–í–û–ï: Safety net - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ callback
  def ensure_callback_answered
    return unless in_callback_context?
    return if @callback_answered

    Rails.logger.warn "Callback query not manually answered in #{self.class}##{caller_locations(2, 1).first.label}, auto-answering"
    auto_answer_callback_query
  end

end
```

### 2.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–ª–µ–≥–∞—Ç–∞ –≤ BaseCommand

```ruby
delegate :developer?, :respond_with, :edit_message,
         :chat, :telegram_user, :t, :bot, to: :controller, allow_nil: true
delegate :find_project, to: :current_user

```

### 2.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ 1

**–¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π safety net**
```ruby
# spec/commands/base_command_spec.rb

RSpec.describe BaseCommand, type: :model do
  let(:controller) { double('controller', payload: { 'callback_query' => { 'id' => '123' } }) }
  let(:command) { TestCommand.new(controller) }
  let(:bot) { double('bot') }

  before do
    allow(controller).to receive(:bot).and_return(bot)
    allow(bot).to receive(:answer_callback_query)
  end

  it 'automatically answers callback query if not answered manually' do
    expect(bot).to receive(:answer_callback_query)

    command.safe_call
  end

  it 'tracks manual answer_callback_query calls' do
    allow(command).to receive(:call) { command.safe_answer_callback_query('Manual answer') }
    
    expect(bot).to receive(:answer_callback_query).with('Manual answer')
    expect(bot).not_to receive(:answer_callback_query).with('‚úÖ')

    command.safe_call
  end
end
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ callback-–º–µ—Ç–æ–¥—ã –Ω–∞—á–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞—Ç—å, –¥–∞–∂–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

---

## 3. –≠—Ç–∞–ø 2: –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ answer_callback_query –≤ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥

### 3.1. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):**
1. `report_command.rb` (5 –º–µ—Ç–æ–¥–æ–≤, —Å–∞–º—ã–µ –ø—Ä–æ—Å—Ç—ã–µ)
2. `add_command.rb` (1 –º–µ—Ç–æ–¥)
3. `users_command.rb` (3 –º–µ—Ç–æ–¥–∞)
4. `edit_command.rb` (3 –º–µ—Ç–æ–¥–∞)
5. `projects_command.rb` (14 –º–µ—Ç–æ–¥–æ–≤, —Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ)

**–ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–æ —à–∞–±–ª–æ–Ω—É:**

### 3.2. –¢–∏–ø–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –∏ —à–∞–±–ª–æ–Ω—ã

#### –®–∞–±–ª–æ–Ω 1: –ü—Ä–æ—Å—Ç–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–±–µ–∑ –æ—à–∏–±–æ–∫)
**–î–æ:**
```ruby
def report_periods_callback_query
  help_formatter = ReportHelpFormatter.new
  text = help_formatter.periods_help
  keyboard = help_formatter.navigation_keyboard('periods')

  edit_message :text, text: text, reply_markup: keyboard
end
```

**–ü–æ—Å–ª–µ:**
```ruby
def report_periods_callback_query
  help_formatter = ReportHelpFormatter.new
  text = help_formatter.periods_help
  keyboard = help_formatter.navigation_keyboard('periods')

  edit_message :text, text: text, reply_markup: keyboard
  safe_answer_callback_query  # –ü—Ä–æ—Å—Ç–æ —É–±—Ä–∞—Ç—å —á–∞—Å–∏–∫–∏
end
```

#### –®–∞–±–ª–æ–Ω 2: –û–ø–µ—Ä–∞—Ü–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ–π –æ—à–∏–±–∫–æ–π
**–î–æ:**
```ruby
def projects_rename_callback_query(data = nil)
  unless data
    Bugsnag.notify(RuntimeError.new('projects_rename_callback_query called without data'))
    return respond_with :message, text: '–ß—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ..'
  end
  show_rename_menu(data)
end
```

**–ü–æ—Å–ª–µ:**
```ruby
def projects_rename_callback_query(data = nil)
  unless data
    Bugsnag.notify(RuntimeError.new('projects_rename_callback_query called without data'))
    safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö')
    return respond_with :message, text: '–ß—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ..'
  end
  show_rename_menu(data)
  safe_answer_callback_query('‚úèÔ∏è –û—Ç–∫—Ä—ã—Ç–æ –º–µ–Ω—é –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è')
end
```

#### –®–∞–±–ª–æ–Ω 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å alert
**–î–æ:**
```ruby
def projects_delete_confirm_callback_query(data = nil)
  unless data
    Bugsnag.notify(RuntimeError.new('projects_delete_confirm_callback_query called without data'))
    return respond_with :message, text: '–ß—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ..'
  end
  request_deletion_confirmation(data)
end
```

**–ü–æ—Å–ª–µ:**
```ruby
def projects_delete_confirm_callback_query(data = nil)
  unless data
    Bugsnag.notify(RuntimeError.new('projects_delete_confirm_callback_query called without data'))
    safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞', show_alert: true)
    return respond_with :message, text: '–ß—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ..'
  end
  request_deletion_confirmation(data)
  safe_answer_callback_query('‚ö†Ô∏è –ó–∞–ø—Ä–æ—à–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è')
end
```

### 3.3. –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

#### –≠—Ç–∞–ø 2.1: report_command.rb (5 –º–µ—Ç–æ–¥–æ–≤, 30 –º–∏–Ω—É—Ç)

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å `app/commands/report_command.rb`
2. –ù–∞–π—Ç–∏ 5 `*_callback_query` –º–µ—Ç–æ–¥–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 111-149)
3. –î–æ–±–∞–≤–∏—Ç—å `safe_answer_callback_query` –≤ –∫–æ–Ω–µ—Ü –∫–∞–∂–¥–æ–≥–æ
4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤: `bundle exec rspec spec/controllers/telegram/webhook/report_command_spec.rb`
5. –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `/report help` –∏ –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º —Å–ø—Ä–∞–≤–∫–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –í—Å–µ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç `edit_message` - –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–æ–Ω–µ—Ü
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, safety net –∏–∑ —ç—Ç–∞–ø–∞ 1 —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–¥ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º

#### –≠—Ç–∞–ø 2.2: add_command.rb (1 –º–µ—Ç–æ–¥, 10 –º–∏–Ω—É—Ç)

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å `app/commands/add_command.rb`
2. –ù–∞–π—Ç–∏ `select_project_callback_query` (—Å—Ç—Ä–æ–∫–∞ ~19)
3. –î–æ–±–∞–≤–∏—Ç—å `safe_answer_callback_query` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –ó–∞–ø—É—Å–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

#### –≠—Ç–∞–ø 2.3: users_command.rb (3 –º–µ—Ç–æ–¥–∞, 40 –º–∏–Ω—É—Ç)

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å `app/commands/users_command.rb`
2. –ù–∞–π—Ç–∏ 3 `*_callback_query` –º–µ—Ç–æ–¥–∞ (—Å—Ç—Ä–æ–∫–∏ 159-191)
3. –î–æ–±–∞–≤–∏—Ç—å `safe_answer_callback_query` –≤ –∫–∞–∂–¥—ã–π
4. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
   - `users_add_project_callback_query`: `'‚úÖ –ü—Ä–æ–µ–∫—Ç –≤—ã–±—Ä–∞–Ω'`
   - `users_add_role_callback_query`: `'‚úÖ –†–æ–ª—å –≤—ã–±—Ä–∞–Ω–∞'`
   - `users_list_project_callback_query`: `'üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'`
5. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –≠—Ç–∞–ø 2.4: edit_command.rb (3 –º–µ—Ç–æ–¥–∞, 40 –º–∏–Ω—É—Ç)

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å `app/commands/edit_command.rb`
2. –ù–∞–π—Ç–∏ 3 –º–µ—Ç–æ–¥–∞ (—Å—Ç—Ä–æ–∫–∏ 59-67)
3. –î–æ–±–∞–≤–∏—Ç—å `safe_answer_callback_query` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

#### –≠—Ç–∞–ø 2.5: projects_command.rb (14 –º–µ—Ç–æ–¥–æ–≤, 2 —á–∞—Å–∞)

**–®–∞–≥–∏ (–ø–æ–¥—ç—Ç–∞–ø—ã):**

**–ü–æ–¥—ç—Ç–∞–ø 2.5.1: –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã (5 –º–µ—Ç–æ–¥–æ–≤, 30 –º–∏–Ω—É—Ç)**
- `projects_create_callback_query`
- `projects_select_callback_query`
- `projects_list_callback_query`
- `projects_rename_callback_query`
- `projects_client_callback_query`

**–ü–æ–¥—ç—Ç–∞–ø 2.5.2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (6 –º–µ—Ç–æ–¥–æ–≤, 50 –º–∏–Ω—É—Ç)**
- `projects_rename_title_callback_query`
- `projects_rename_slug_callback_query`
- `projects_rename_both_callback_query`
- `projects_rename_use_suggested_callback_query`
- `projects_client_edit_callback_query`
- `projects_client_delete_callback_query`

**–ü–æ–¥—ç—Ç–∞–ø 2.5.3: –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞ (3 –º–µ—Ç–æ–¥–∞, 40 –º–∏–Ω—É—Ç)**
- `projects_client_delete_confirm_callback_query`
- `projects_delete_callback_query`
- `projects_delete_confirm_callback_query`

**–í–∞–∂–Ω–æ:** –í –º–µ—Ç–æ–¥–∞—Ö —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `show_alert: true` –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### 3.4. –û–±—â–∏–π —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã `*_callback_query` –Ω–∞–π–¥–µ–Ω—ã
- [ ] –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ `data` —Å `safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞')` –ø—Ä–∏ –æ—à–∏–±–∫–µ
- [ ] –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ "happy path": `safe_answer_callback_query('‚úÖ/üìã/...')`
- [ ] –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (—É–¥–∞–ª–µ–Ω–∏–µ): `show_alert: true`
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI

---

## 4. –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 4.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ callback –æ—Ç–≤–µ—Ç—ã

**–û–±—â–∏–π shared example:**
```ruby
# spec/support/shared_examples/telegram_callback_responses.rb

RSpec.shared_examples 'callback query responder' do
  it 'answers callback query' do
    expect { subject }.to make_telegram_request(bot, :answerCallbackQuery)
  end
end

RSpec.shared_examples 'callback query with message' do |message_part|
  it "answers callback query with message containing '#{message_part}'" do
    expect { subject }.to make_telegram_request(bot, :answerCallbackQuery).with(
      hash_including(text: match(/#{message_part}/))
    )
  end
end
```

### 4.2. –¢–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã

#### –î–ª—è report_command
```ruby
# spec/controllers/telegram/webhook/report_command_spec.rb

RSpec.describe Telegram::WebhookController, telegram_bot: :rails do
  describe 'callback queries' do
    describe '#report_periods_callback_query' do
      let(:data) { 'report_periods:' }
      subject { dispatch(callback_query: { data: data }) }

      include_examples 'callback query responder'
      include_examples 'callback query with message', '–ø–µ—Ä–∏–æ–¥'
    end

    describe '#report_filters_callback_query' do
      let(:data) { 'report_filters:' }
      subject { dispatch(callback_query: { data: data }) }

      include_examples 'callback query responder'
      include_examples 'callback query with message', '—Ñ–∏–ª—å—Ç—Ä'
    end

    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ 3 –º–µ—Ç–æ–¥–∞
  end
end
```

#### –î–ª—è projects_command (—Å–ª–æ–∂–Ω–µ–µ)
```ruby
# spec/controllers/telegram/webhook/projects_command_spec.rb

RSpec.describe Telegram::WebhookController, telegram_bot: :rails do
  let(:user) { users(:user_with_telegram) }
  let(:project) { projects(:existing_project) }

  describe 'projects callback queries' do
    describe '#projects_rename_callback_query' do
      let(:data) { "projects_rename:#{project.slug}" }
      subject { dispatch(callback_query: { data: data }) }

      include_examples 'callback query responder'
      include_examples 'callback query with message', '–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ'
    end

    describe '#projects_delete_confirm_callback_query' do
      let(:data) { "projects_delete_confirm:#{project.slug}" }
      subject { dispatch(callback_query: { data: data }) }

      it 'answers with alert' do
        expect { subject }.to make_telegram_request(bot, :answerCallbackQuery).with(
          hash_including(show_alert: true)
        )
      end
    end

    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ 12 –º–µ—Ç–æ–¥–æ–≤
  end
end
```

### 4.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:**
```ruby
# spec/features/telegram_callback_flow_spec.rb

RSpec.feature 'Telegram callback query flow', telegram_bot: :rails do
  scenario 'user navigates through project menu without hanging buttons' do
    # 1. User calls /projects
    response = dispatch_command :projects
    expect(response).to be_present

    # 2. User clicks on project
    response = dispatch(callback_query: {
      data: "projects_select:#{project.slug}",
      message: response.first
    })
    expect(response).to be_present
    expect(bot.requests[:answerCallbackQuery]).to be_present

    # 3. User clicks rename
    response = dispatch(callback_query: {
      data: "projects_rename:#{project.slug}",
      message: response.first
    })
    expect(response).to be_present
    expect(bot.requests[:answerCallbackQuery]).to be_present

    # 4. Verify button doesn't hang (no duplicate answerCallbackQuery after 30s)
    expect(bot.requests[:answerCallbackQuery].count).to eq(2)
  end
end
```

### 4.4. –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

- [ ] **/projects** ‚Üí –∫–ª–∏–∫ –ø–æ –ø—Ä–æ–µ–∫—Ç—É ‚Üí –∫–ª–∏–∫ "–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å" ‚Üí —á–∞—Å–∏–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
- [ ] **/report help** ‚Üí –∫–ª–∏–∫ –ø–æ "üìÖ –ü–µ—Ä–∏–æ–¥—ã" ‚Üí –∫–ª–∏–∫ –ø–æ "üîç –§–∏–ª—å—Ç—Ä—ã" ‚Üí –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫
- [ ] **/edit** ‚Üí –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –∫–ª–∏–∫ –ø–æ –ø–æ–ª—é ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–æ–¥–≤–∏—Å–∞–Ω–∏—è
- [ ] **/users** ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –≤—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –∫–ª–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- [ ] **/projects** ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è alert –∏ –∑–∞—Ç–µ–º —É–±–∏—Ä–∞–µ—Ç—Å—è
- [ ] **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –±—ã—Å—Ç—Ä–æ–µ –Ω–∞–∂–∞—Ç–∏–µ** ‚Üí –∫–Ω–æ–ø–∫–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (Telegram –±–ª–æ–∫–∏—Ä—É–µ—Ç)

---

## 5. –†–µ–ª–∏–∑ –∏ –¥–µ–ø–ª–æ–π

### 5.1. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–ª–∏–∑–∞

**–≠—Ç–∞–ø 1 (–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ):**
```bash
# –í –ª–∏—á–Ω–æ–π –≤–µ—Ç–∫–µ
1. –î–æ–±–∞–≤–∏—Ç—å BaseCommand –∏–∑–º–µ–Ω–µ–Ω–∏—è (safety net)
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–æ—Ç–æ–º
3. –°–¥–µ–ª–∞—Ç—å PR —Å —Ç–æ–ª—å–∫–æ safety net –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
4. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤ production
```

**–≠—Ç–∞–ø 2 (–ß–µ—Ä–µ–∑ 1-2 –¥–Ω—è, –ø–æ—Å–ª–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞):**
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã (–∏–ª–∏ –æ–¥–Ω–æ–π –≤–µ—Ç–∫–µ)
1. report_command (5 –º–µ—Ç–æ–¥–æ–≤)
2. add_command (1 –º–µ—Ç–æ–¥)
3. users_command (3 –º–µ—Ç–æ–¥–∞)
4. edit_command (3 –º–µ—Ç–æ–¥–∞)
5. projects_command (14 –º–µ—Ç–æ–¥–æ–≤)

# –ö–∞–∂–¥—ã–π PR –≤–∫–ª—é—á–∞–µ—Ç:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥–µ
- –¢–µ—Å—Ç—ã –¥–ª—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

### 5.2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞

**–ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:**
- [ ] –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤ `answerCallbackQuery` (–¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞—Å—Ç–∏)
- [ ] –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ callback (–¥–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –∑–∞ <1 —Å–µ–∫—É–Ω–¥—É)
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ "–∑–∞–≤–∏—Å—à–∏—Ö" –∫–Ω–æ–ø–æ–∫ (–¥–æ–ª–∂–Ω–æ —É–ø–∞—Å—Ç—å –¥–æ 0)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∂–∞–ª–æ–±—ã –≤ Telegram
- [ ] –û—à–∏–±–∫–∏ –≤ Bugsnag –Ω–∞ –≤—ã–∑–æ–≤—ã `answerCallbackQuery`

**KPI –¥–æ/–ø–æ—Å–ª–µ:**
```
–î–æ: 0 answerCallbackQuery –≤ –º–∏–Ω—É—Ç—É
–ü–æ—Å–ª–µ (–≠—Ç–∞–ø 1): ~50-100 answerCallbackQuery –≤ –º–∏–Ω—É—Ç—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ)
–ü–æ—Å–ª–µ (–≠—Ç–∞–ø 2): ~50-100 answerCallbackQuery –≤ –º–∏–Ω—É—Ç—É (—è–≤–Ω—ã–µ)
```

### 5.3. Rollback –ø–ª–∞–Ω

**–û—Ç–∫–∞—Ç –≠—Ç–∞–ø–∞ 1 (Safety Net):**
```bash
# –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–º–º–∏—Ç –≤ BaseCommand
git revert <commit-hash>
# –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å PR –≤ GitHub
# –ù–∏–∫–∞–∫–∏—Ö side effects –Ω–µ—Ç, —Ç.–∫. —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

**–û—Ç–∫–∞—Ç –≠—Ç–∞–ø–∞ 2 (–†—É—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è):**
```bash
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:
git revert <commit-hash>

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –±—ã—Å—Ç—Ä—ã–π –ø–∞—Ç—á - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ `safe_answer_callback_query` –≤—ã–∑–æ–≤—ã
find app/commands -name "*.rb" -exec sed -i '/safe_answer_callback_query/d' {} \
```

---

## 6. –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 6.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤

–í `BaseCommand.safe_answer_callback_query`:
```ruby
Rails.logger.debug "Callback answered in #{self.class}: #{text || 'default'}"
```

–í `BaseCommand.ensure_callback_answered`:
```ruby
Rails.logger.warn "Auto-answered callback in #{self.class}##{method} (developer forgot to call safe_answer_callback_query)"
```

### 6.2. –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°—á–µ—Ç—á–∏–∫–∏ (–º–æ–∂–Ω–æ –≤ StatsD/Prometheus):

```ruby
# –í —É—Å–ø–µ—à–Ω–æ–º —Ä—É—á–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
increment('telegram.callback.answered.manual')

# –í –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –æ—Ç–≤–µ—Ç–µ
increment('telegram.callback.answered.auto')

# –í –æ—à–∏–±–∫–µ –æ—Ç–≤–µ—Ç–∞
increment('telegram.callback.answered.error')
```

---

## 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —á–µ–∫-–ª–∏—Å—Ç—ã

### 7.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AGENTS.md

–î–æ–±–∞–≤–∏—Ç—å –≤ `docs/development/telegram-response-methods.md` —Ä–∞–∑–¥–µ–ª:

```markdown
## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å callback_query

### –ü—Ä–∞–≤–∏–ª–æ 1: –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ callback_query

**–î–û:**
```ruby
def projects_rename_callback_query(data)
  show_rename_menu(data)
end
```

**–ü–û–°–õ–ï:**
```ruby
def projects_rename_callback_query(data)
  show_rename_menu(data)
  safe_answer_callback_query('‚úèÔ∏è –ú–µ–Ω—é –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç–æ')
end
```

### –ü—Ä–∞–≤–∏–ª–æ 2: –û—Ç–≤–µ—á–∞–π—Ç–µ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

```ruby
def projects_rename_callback_query(data)
  unless data
    safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞', show_alert: true)
    return respond_with :message, text: '–û—à–∏–±–∫–∞'
  end
  # ...
end
```
```

### 7.2. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö callback –º–µ—Ç–æ–¥–æ–≤

–í —à–∞–±–ª–æ–Ω –Ω–æ–≤–æ–≥–æ callback –º–µ—Ç–æ–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å:

```ruby
def new_feature_callback_query(data = nil)
  unless data
    safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞', show_alert: true)
    return respond_with :message, text: '–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö'
  end

  # ... –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ...

  safe_answer_callback_query('‚úÖ –£—Å–ø–µ—Ö')
end
```

### 7.3. Pull Request Template

```markdown
## Callback Query Changes Checklist

- [ ] –í—Å–µ –Ω–æ–≤—ã–µ `*_callback_query` –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç `safe_answer_callback_query`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å `safe_answer_callback_query('‚ùå –û—à–∏–±–∫–∞')`
- [ ] –¢–µ—Å—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –ù–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –∫–Ω–æ–ø–æ–∫ –≤ UI
```

---

## 8. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤

### –≠—Ç–∞–ø 1: Safety Net (BaseCommand)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 1 —á–∞—Å
- –¢–µ—Å—Ç—ã: 30 –º–∏–Ω—É—Ç
- –†–µ–≤—å—é: 30 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 2 —á–∞—Å–∞**

### –≠—Ç–∞–ø 2.1: report_command.rb (5 –º–µ—Ç–æ–¥–æ–≤)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 30 –º–∏–Ω—É—Ç
- –¢–µ—Å—Ç—ã: 30 –º–∏–Ω—É—Ç
- –†–µ–≤—å—é: 20 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 1 —á–∞—Å 20 –º–∏–Ω—É—Ç**

### –≠—Ç–∞–ø 2.2: add_command.rb (1 –º–µ—Ç–æ–¥)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 10 –º–∏–Ω—É—Ç
- –¢–µ—Å—Ç—ã: 10 –º–∏–Ω—É—Ç
- –†–µ–≤—å—é: 10 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 30 –º–∏–Ω—É—Ç**

### –≠—Ç–∞–ø 2.3: users_command.rb (3 –º–µ—Ç–æ–¥–∞)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 20 –º–∏–Ω—É—Ç
- –¢–µ—Å—Ç—ã: 20 –º–∏–Ω—É—Ç
- –†–µ–≤—å—é: 15 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 55 –º–∏–Ω—É—Ç**

### –≠—Ç–∞–ø 2.4: edit_command.rb (3 –º–µ—Ç–æ–¥–∞)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 20 –º–∏–Ω—É—Ç
- –¢–µ—Å—Ç—ã: 20 –º–∏–Ω—É—Ç
- –†–µ–≤—å—é: 15 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 55 –º–∏–Ω—É—Ç**

### –≠—Ç–∞–ø 2.5: projects_command.rb (14 –º–µ—Ç–æ–¥–æ–≤)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 2 —á–∞—Å–∞
- –¢–µ—Å—Ç—ã: 1 —á–∞—Å
- –†–µ–≤—å—é: 30 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 3 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç**

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: 1 —á–∞—Å
- –†–µ–≤—å—é: 30 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 1 —á–∞—Å 30 –º–∏–Ω—É—Ç**

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: 30 –º–∏–Ω—É—Ç
- –î–∞—à–±–æ—Ä–¥—ã: 30 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 1 —á–∞—Å**

---

## **–û–ë–©–ï–ï –í–†–ï–ú–Ø: ~10 —á–∞—Å–æ–≤** (—Ä–∞–∑–±–∏—Ç–æ –Ω–∞ 2-3 –¥–Ω—è)

---

## 9. –†–∏—Å–∫–∏ –∏ –∏—Ö —Å–º—è–≥—á–µ–Ω–∏–µ

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –°–º—è–≥—á–µ–Ω–∏–µ |
|------|------------|---------|-----------|
| –ó–∞–±—ã—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Safety net –∏–∑ —ç—Ç–∞–ø–∞ 1, –ª–∏–Ω—Ç–µ—Ä—ã, —á–µ–∫-–ª–∏—Å—Ç—ã |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç alert | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | –¢–µ—Å—Ç—ã UI, –º–∞–Ω—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ answerCallbackQuery | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –§–ª–∞–≥ `@callback_answered`, —Ç–µ—Å—Ç—ã |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ª–∏—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã) | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–±—ã–ª–∏ |
| –°—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | Telegram API –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |

---

## 10. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

- **Callback Query**: –ó–∞–ø—Ä–æ—Å –æ—Ç Telegram –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ inline-–∫–Ω–æ–ø–∫–∏
- **Answer Callback Query**: –û—Ç–≤–µ—Ç –±–æ—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É
- **Safety Net**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–±—ã–ª –≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
- **`safe_answer_callback_query`**: –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `answer_callback_query` —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

---

## 11. –°—Å—ã–ª–∫–∏

- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã](docs/development/telegram-callback-query-analysis.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–µ—Ç–æ–¥–∞–º –æ—Ç–≤–µ—Ç–æ–≤](docs/development/telegram-response-methods.md)
- [Telegram Bot API: answerCallbackQuery](https://core.telegram.org/bots/api#answercallbackquery)
- [Callback Query Guide](docs/development/telegram-callback-guide.md)

---

**–ê–≤—Ç–æ—Ä—ã –ø–ª–∞–Ω–∞:** AI Assistant  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-15  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
