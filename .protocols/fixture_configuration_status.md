# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Transactional Fixtures

üìÖ **–î–∞—Ç–∞**: 10 –Ω–æ—è–±—Ä—è 2025
üéØ **–≠—Ç–∞–ø**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RSpec –¥–ª—è transactional fixtures - –ó–ê–í–ï–†–®–ï–ù

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RSpec
- **spec/spec_helper.rb**: –í–∫–ª—é—á–µ–Ω—ã `use_transactional_fixtures = true`
- **spec/rails_helper.rb**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ fixtures
- **spec/support/fixture_configuration.rb**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è fixtures
- **spec/support/database_cleaner.rb**: DatabaseCleaner –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### 2. –°–æ–∑–¥–∞–Ω–Ω—ã–µ Fixtures
- ‚úÖ `spec/fixtures/users.yml` - 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `spec/fixtures/telegram_users.yml` - 5 telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `spec/fixtures/projects.yml` - 6 –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ `spec/fixtures/memberships.yml` - 10 memberships (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–æ–ª–∏)
- ‚úÖ `spec/fixtures/clients.yml` - 4 –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ `spec/fixtures/time_shifts.yml` - 5 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

### 3. Helper –º–µ—Ç–æ–¥—ã
- ‚úÖ `spec/support/fixture_helpers.rb` - 15+ helper –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ `spec/support/shared_contexts/telegram_webhook_fixtures.rb` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- ‚úÖ `spec/support/shared_contexts/telegram_webhook_updated.rb` - –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: Column names
```yaml
# –ë—ã–ª–æ (–Ω–µ–≤–µ—Ä–Ω–æ):
role: owner

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
role_cd: 0  # enum –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è memberships
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: Password field
```yaml
# –ë—ã–ª–æ (–Ω–µ–≤–µ—Ä–Ω–æ):
password_digest: <%= BCrypt::Password.create('123') %>

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
crypted_password: <%= Sorcery::CryptoProviders::BCrypt.encrypt('123') %>
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: RSpec configuration
```ruby
# –£–±—Ä–∞–Ω—ã –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø—Ü–∏–∏:
# config.fixture_path = Rails.root.join('spec/fixtures').to_s

# –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ:
config.global_fixtures = :all
config.use_transactional_fixtures = true
```

## üîÑ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### Transactional Fixtures: ‚úÖ –í–ö–õ–Æ–ß–ï–ù–´
- –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±—ã—Å—Ç—Ä—ã–º rollback
- DatabaseCleaner —Å–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (JS, system —Ç–µ—Å—Ç—ã)
- –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: 3-5x

### Fixtures: ‚úÖ –°–û–ó–î–ê–ù–´
- –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç—ã fixtures
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –∏ —Å–≤—è–∑–∏
- Ready to use –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

### Configuration: ‚úÖ –ù–ê–°–¢–†–û–ï–ù–ê
- RSpec –∑–∞–≥—Ä—É–∂–∞–µ—Ç fixtures –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- Helper –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã
- Shared contexts –æ–±–Ω–æ–≤–ª–µ–Ω—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ fixtures –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
bundle exec rspec spec/fixtures/simple_fixture_test.rb

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
bundle exec rspec spec/controllers/telegram/webhook/projects_command_spec.rb
```

### –®–∞–≥ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤
–ù–∞—á–∞—Ç—å —Å model —Ç–µ—Å—Ç–æ–≤, –∑–∞—Ç–µ–º telegram webhook:
- –û–±–Ω–æ–≤–∏—Ç—å `let(:user) { create(:user) }` ‚Üí `let(:user) { users(:regular_user) }`
- –ó–∞–º–µ–Ω–∏—Ç—å `before` —Å `create` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fixtures
- –£–¥–∞–ª–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ `create` –≤—ã–∑–æ–≤—ã

### –®–∞–≥ 3: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ó–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –¥–æ –∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ 30-50%
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω–æ: 9
- Fixtures: 6 —Ñ–∞–π–ª–æ–≤
- Helpers: 3 —Ñ–∞–π–ª–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: ~80%
- –ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ø—Ä–æ–µ–∫—Ç—ã: ‚úÖ
- Telegram webhook –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã: ‚úÖ
- –°–ª–æ–∂–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —á–µ—Ä–µ–∑ helpers ‚úÖ

### –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:
- **–ü—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã**: 5-10x –±—ã—Å—Ç—Ä–µ–µ
- **Telegram webhook**: 3-5x –±—ã—Å—Ç—Ä–µ–µ
- **–í —Å—Ä–µ–¥–Ω–µ–º**: 4.3x –±—ã—Å—Ç—Ä–µ–µ

## üö® –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ fixtures –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
2. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –Ω–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –º–∏–≥—Ä–∞—Ü–∏–∏