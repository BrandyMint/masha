# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ answer_callback_query –¥–ª—è Telegram Callback Query

**–î–∞—Ç–∞:** 2025-11-16
**–¢–∏–ø:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (P0)
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## 1. –û–±–∑–æ—Ä

### 1.1. –ü—Ä–æ–±–ª–µ–º–∞
–í –ø—Ä–æ–µ–∫—Ç–µ Mashtime.ru –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç **26 –º–µ—Ç–æ–¥–æ–≤ `*_callback_query`** –≤ 5 —Ñ–∞–π–ª–∞—Ö, –Ω–∏ –æ–¥–∏–Ω –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `answer_callback_query()`. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:

- –ö–Ω–æ–ø–∫–∏ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (—á–∞—Å—ã) –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–ª–æ—Ö–æ–π UX –∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ –±–æ—Ç –∑–∞–≤–∏—Å

### 1.2. –¶–µ–ª–∏
1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 –¥–Ω–µ–π
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è:** –í–Ω–µ–¥—Ä–∏—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–π –ø–æ–¥–æ–±–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –±—É–¥—É—â–µ–º
3. –û–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –≤—Å–µ—Ö callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 1.3. –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è
- –§–∞–π–ª—ã –∫–æ–º–∞–Ω–¥: `projects_command.rb`, `report_command.rb`, `edit_command.rb`, `users_command.rb`, `add_command.rb`
- –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã: `BaseCommand`, `WebhookController`
- –¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ shared examples –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤

## 2. –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### 2.1. –í–∞—Ä–∏–∞–Ω—Ç A: –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (Quick & Dirty)
–†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `answer_callback_query()` –≤ –∫–∞–∂–¥—ã–π –∏–∑ 26 –º–µ—Ç–æ–¥–æ–≤.

**–ü–ª—é—Å—ã:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —è–≤–Ω–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ `show_alert`

**–ú–∏–Ω—É—Å—ã:**
- 26 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Å—Ç –¥–ª—è –æ—à–∏–±–∫–∏
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö callback-–º–µ—Ç–æ–¥–æ–≤ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–º–Ω–∏—Ç—å –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è answer
- –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ

**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏:** 2-3 —á–∞—Å–∞, —Å—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫

### 2.2. –í–∞—Ä–∏–∞–Ω—Ç B: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ around_action (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
–°–æ–∑–¥–∞–Ω–∏–µ `around_action` –≤ `WebhookController`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ callback_query.

**–ü–ª—é—Å—ã:**
- –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏ –±—É–¥—É—â–∏—Ö callback'–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–≥–æ—Ä—è—á–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

**–ú–∏–Ω—É—Å—ã:**
- –ú–µ–Ω–µ–µ —è–≤–Ω–æ (–º–∞–≥–∏—è)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å `show_alert: true` (–Ω—É–∂–Ω—ã —Ö–∞–∫–∏)
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—è–¥–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏:** 1 —á–∞—Å, –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞

### 2.3. –í–∞—Ä–∏–∞–Ω—Ç C: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö–µ–ª–ø–µ—Ä–∞ `safe_answer_callback_query()` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø–∞—Å–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º (safety net).

**–ü–ª—é—Å—ã:**
- –Ø–≤–Ω—ã–π –≤—ã–∑–æ–≤ –≤ –∫–æ–¥–µ (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–±—ã–≤—á–∏–≤–æ—Å—Ç–∏
- –ì–∏–±–∫–æ—Å—Ç—å —Å —Ç–µ–∫—Å—Ç–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ú–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö 26 –º–µ—Ç–æ–¥–æ–≤ (–Ω–æ —Å –ø—Ä–æ—Å—Ç—ã–º API)
- –ù—É–∂–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å

**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏:** 3-4 —á–∞—Å–∞, –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫

## 3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 3.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–í–∞—Ä–∏–∞–Ω—Ç C)

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **`BaseCommand#safe_answer_callback_query`** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±–µ—Ä—Ç–∫–∞ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. **`BaseCommand#ensure_callback_answered`** ‚Äî –∑–∞–ø–∞—Å–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º (safety net) –≤ `safe_call`
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 26 –º–µ—Ç–æ–¥–æ–≤** ‚Äî –∑–∞–º–µ–Ω–∞/–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤
4. **–¢–µ—Å—Ç–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫** ‚Äî shared example –¥–ª—è –≤—Å–µ—Ö callback handlers

### 3.2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

| –°—Ü–µ–Ω–∞—Ä–∏–π | –¢–∏–ø –æ—Ç–≤–µ—Ç–∞ | –ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ |
|----------|-----------|---------------|
| –û–±—ã—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–ø–µ—Ä–µ—Ö–æ–¥ –º–µ–Ω—é) | –ë–µ–∑ —Ç–µ–∫—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ —É–±—Ä–∞—Ç—å —á–∞—Å—ã) | `safe_answer_callback_query` |
| –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω—ã | –ö—Ä–∞—Ç–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ | `"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ"` |
| –í–∞–∂–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (—É–¥–∞–ª–µ–Ω–∏–µ) | –ü–æ–∫–∞–∑–∞—Ç—å alert | `"üö® –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è"`, `show_alert: true` |
| –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | Alert —Å –æ—à–∏–±–∫–æ–π | `"‚ùå –û—à–∏–±–∫–∞: #{error.message}"`, `show_alert: true` |

## 4. –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ß–∞—Å—ã: 0.5)
- [ ] –°–æ–∑–¥–∞—Ç—å feature-branch: `feature/answer-callback-query-fix`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `BaseCommand` —Å –º–µ—Ç–æ–¥–∞–º–∏ `safe_answer_callback_query` –∏ `ensure_callback_answered`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ö–µ–ª–ø–µ—Ä `callback_query_context?`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `make test`

**–ö–æ–¥ –¥–ª—è `app/commands/base_command.rb`:**
```ruby
# –î–æ–±–∞–≤–∏—Ç—å –≤ protected —Å–µ–∫—Ü–∏—é
def safe_answer_callback_query(text = nil, params = {})
  @callback_answered = true
  answer_callback_query(text, params) if callback_query_context?
end

def callback_query_context?
  controller&.payload&.key?('callback_query')
end

# –î–æ–±–∞–≤–∏—Ç—å –≤ safe_call –º–µ—Ç–æ–¥
def safe_call(*args)
  Rails.logger.info "#{self.class}.call with args #{args}"
  return respond_with :message, text: I18n.t('telegram.errors.developer_access_denied') if self.class.developer_only? && !developer?

  @callback_answered = false
  result = call(*args)
  ensure_callback_answered
  result
end

private

def ensure_callback_answered
  return unless callback_query_context?
  return if @callback_answered

  Rails.logger.warn "Callback query not answered in #{self.class}##{caller_locations.first.label}, auto-answering"
  answer_callback_query
end
```

### –≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø–∞–º–∏ (–ß–∞—Å—ã: 2.5)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: report_command.rb (5 –º–µ—Ç–æ–¥–æ–≤)**
- [ ] `report_periods_callback_query` ‚Äî simple answer
- [ ] `report_filters_callback_query` ‚Äî simple answer
- [ ] `report_options_callback_query` ‚Äî simple answer
- [ ] `report_examples_callback_query` ‚Äî simple answer
- [ ] `report_main_callback_query` ‚Äî simple answer

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: edit_command.rb (3 –º–µ—Ç–æ–¥–∞)**
- [ ] `edit_field_callback_query` ‚Äî simple answer
- [ ] `edit_project_callback_query` ‚Äî simple answer
- [ ] `edit_confirm_callback_query` ‚Äî answer with confirmation text

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: users_command.rb (3 –º–µ—Ç–æ–¥–∞)**
- [ ] `users_add_project_callback_query` ‚Äî simple answer
- [ ] `users_add_role_callback_query` ‚Äî simple answer
- [ ] `users_list_project_callback_query` ‚Äî simple answer

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: add_command.rb (1 –º–µ—Ç–æ–¥)**
- [ ] `select_project_callback_query` ‚Äî simple answer

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: projects_command.rb (14 –º–µ—Ç–æ–¥–æ–≤)**
- [ ] `projects_create_callback_query`
- [ ] `projects_select_callback_query`
- [ ] `projects_list_callback_query`
- [ ] `projects_rename_callback_query`
- [ ] `projects_rename_title_callback_query`
- [ ] `projects_rename_slug_callback_query`
- [ ] `projects_rename_both_callback_query`
- [ ] `projects_rename_use_suggested_callback_query`
- [ ] `projects_client_callback_query`
- [ ] `projects_client_edit_callback_query`
- [ ] `projects_client_delete_callback_query`
- [ ] `projects_client_delete_confirm_callback_query`
- [ ] `projects_delete_callback_query`
- [ ] `projects_delete_confirm_callback_query` ‚Äî answer with alert

**–®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞:**
```ruby
# –î–û
def name_callback_query(data = nil)
  # ... –ª–æ–≥–∏–∫–∞ ...
  edit_message :text, text: text, reply_markup: keyboard
end

# –ü–û–°–õ–ï
def name_callback_query(data = nil)
  # ... –ª–æ–≥–∏–∫–∞ ...
  edit_message :text, text: text, reply_markup: keyboard
  safe_answer_callback_query  # –∏–ª–∏ —Å —Ç–µ–∫—Å—Ç–æ–º: safe_answer_callback_query("‚úÖ –ì–æ—Ç–æ–≤–æ")
end
```

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ß–∞—Å—ã: 1)

- [ ] –°–æ–∑–¥–∞—Ç—å shared example: `spec/support/shared_examples/callback_answered_spec.rb`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è 3-5 –∫–ª—é—á–µ–≤—ã—Ö callback'–æ–≤ –∫–∞–∫ –ø—Ä–∏–º–µ—Ä
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: `make test`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π "Callback query not answered"

**Shared example:**
```ruby
# spec/support/shared_examples/callback_answered_spec.rb
RSpec.shared_examples 'callback query handler' do
  it 'answers callback_query' do
    expect { subject }.to make_telegram_request(bot, :answerCallbackQuery)
  end
end

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ spec/controllers/telegram/webhook/report_command_spec.rb
RSpec.describe Telegram::WebhookController do
  describe '#report_periods_callback_query' do
    subject { dispatch(callback_query: { data: 'report_periods:' }) }
    
    include_examples 'callback query handler'
  end
end
```

### –≠—Ç–∞–ø 4: –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ß–∞—Å—ã: 1)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ: `./bin/dev`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 2-3 –∫–ª—é—á–µ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞:
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (projects_rename_callback_query)
  - –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ø—Ä–∞–≤–∫–µ (report_periods_callback_query)
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è (projects_delete_confirm_callback_query)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —á–∞—Å–∏–∫–∏ –±–æ–ª—å—à–µ 1-2 —Å–µ–∫—É–Ω–¥
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –Ω–µ —Å–ª–æ–º–∞–Ω–∞

### –≠—Ç–∞–ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ CI/CD (–ß–∞—Å—ã: 0.5)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ BaseCommand
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤ TODO.md –¥–ª—è –Ω–æ–≤—ã—Ö callback –º–µ—Ç–æ–¥–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å gist —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö PR

## 5. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### 5.1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ **0** –º–µ—Ç–æ–¥–æ–≤ –±–µ–∑ `answer_callback_query` (–±—ã–ª–æ 26)
- ‚úÖ **100%** –∫–ª—é—á–µ–≤—ã—Ö callback'–æ–≤ –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ (–º–∏–Ω–∏–º—É–º 5)
- ‚úÖ **<2 —Å–µ–∫—É–Ω–¥** —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –∫–Ω–æ–ø–∫–∏ (–±—ã–ª–æ 30+ —Å–µ–∫—É–Ω–¥)

### 5.2. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–æ–æ–±—â–∞—é—Ç –æ "–∑–∞–≤–∏—Å—à–∏—Ö –∫–Ω–æ–ø–∫–∞—Ö"
- ‚úÖ –í –ª–æ–≥–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è "Callback query not answered"
- ‚úÖ –ù–æ–≤—ã–µ callback-–º–µ—Ç–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã safety net

## 6. –†–∏—Å–∫–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### 6.1. –†–∏—Å–∫–∏
| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|------------|---------|-----------|
| –ó–∞–±—ã—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ safety net |
| –°–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –°—Ç–∞–¥–∏–π–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è + —Ç–µ—Å—Ç—ã |
| –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—è–¥–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ |

### 6.2. Rollback –ø–ª–∞–Ω
–ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. –û—Ç–∫–∞—Ç–∏—Ç—å feature-branch
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å hotfix (–í–∞—Ä–∏–∞–Ω—Ç B) —Å `after_action`
3. –í—ã–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ç—á-–≤–µ—Ä—Å–∏—é –∑–∞ 30 –º–∏–Ω—É—Ç

## 7. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –í—Å–µ 26 –º–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `make test` (–≤—Å–µ –∑–µ–ª–µ–Ω—ã–µ)
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- [ ] –í –ª–æ–≥–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- [ ] PR —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–Ω–∫–∞—Å—Ç—ã "–¥–æ/–ø–æ—Å–ª–µ" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## 8. –°—Ä–æ–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 5-6 —á–∞—Å–æ–≤
- **–î–µ–ø–ª–æ–π:** –í —Ç–µ—á–µ–Ω–∏–µ 1-2 –¥–Ω–µ–π –ø–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ì–æ—Ä—è—á–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (hotfix):** 30 –º–∏–Ω—É—Ç –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç B, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –£—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é
2. –°–æ–∑–¥–∞—Ç—å feature-branch
3. –ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1 (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤)
4. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥
