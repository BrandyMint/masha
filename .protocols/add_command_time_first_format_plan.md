# План имплементации поддержки формата `/add time project_slug description`

## Обзор

Текущие тесты проверяют только формат `/add project_slug time description`. Нужно добавить поддержку формата `/add time project_slug description`.

## Текущий статус

**Проверяемый вариант:**
- `/add project_slug time description` ✅

**Отсутствует проверка и поддержка:**
- `/add time project_slug description` ❌

## План задач

### 1. Анализ текущей реализации ✅
- [x] Проанализировать текущую реализацию команды /add для понимания логики парсинга параметров
- [x] Изучить существующую логику обработки разных форматов команд в проекте
- [x] Определить необходимый порядок параметров и их валидацию

### 2. Тестирование ✅
- [x] Написать тест для варианта `/add time project_slug description` в AddCommand
- [x] Запустить тесты и убедиться что AddCommand не поддерживает этот формат
- [x] Проверить что TelegramTimeTracker уже поддерживает оба формата

### 3. Валидация моделей ✅
- [x] Добавить валидацию в модель Project чтобы slug не мог быть целым числом
- [x] Написать тесты для валидации

### 4. Имплементация AddCommand ✅
- [x] Модифицировать AddCommand для поддержки формата `/add time project_slug description`
- [x] Обеспечить обратную совместимость с существующим форматом

### 5. Финальное тестирование ✅
- [x] Запустить все тесты и убедиться что всё работает
- [x] Проверить что оба формата корректно обрабатываются в AddCommand

## Результат ✅

**Успешно реализована поддержка обоих форматов команды `/add`:**

1. **Формат `/add project_slug time description`** - поддерживается ✅
2. **Формат `/add time project_slug description`** - теперь поддерживается ✅

**Изменения:**

1. **AddCommand** (`app/commands/add_command.rb`):
   - Добавлена логика определения формата команды
   - Поддержка формата "время проект описание"
   - Сохранена обратная совместимость

2. **Project model** (`app/models/project.rb`):
   - Добавлена валидация что slug не может быть целым числом
   - Это предотвращает неоднозначность при парсинге

3. **Тесты**:
   - Добавлены тесты для проверки обоих форматов в AddCommand
   - Добавлены тесты для валидации Project slug
   - Все тесты проходят успешно

**Примеры использования:**
- `/add work-project 2 "Работа над задачей"` ✅
- `/add 2 work-project "Работа над задачей"` ✅

## Детали анализа

### Что нужно изучить:
1. **Команда `/add`**: текущая логика парсинга аргументов
2. **Обработка команд**: как проект обрабатывает разные форматы
3. **Валидация параметров**: порядок и типы параметров
4. **Совместимость**: обеспечение поддержки обоих форматов

### Ожидаемый результат:
Пользователь сможет использовать оба формата команды:
- `/add work-project 2 "Работа над задачей"`
- `/add 2 work-project "Работа над задачей"`

## Дополнительные задачи

### Валидация моделей
- [ ] Добавить валидацию в модель Project, чтобы slug не мог быть целым числом
- [ ] Это позволит избежать неоднозначности при парсинге формата `time project_slug`

## Следующие шаги

1. Изучить файлы: `app/commands/add_command.rb` и связанные сервисы
2. Проанализировать логику парсинга параметров
3. Написать тесты для нового формата
4. Реализовать поддержку обоих форматов