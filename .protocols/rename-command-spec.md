# Бизнес-спецификация команды `/rename`

## Обзор

Команда `/rename` позволяет пользователям переименовывать проекты через Telegram-бота. Команда уже реализована и предоставляет два режима использования: прямой и интерактивный.

## Бизнес-требования

### 1. Пользовательские сценарии

#### Сценарий 1: Прямое переименование
**Пользователь:** Владелец проекта
**Действие:** Отправляет команду `/rename project-slug "Новое название"`
**Результат:** Проект немедленно переименован

#### Сценарий 2: Интерактивное переименование
**Пользователь:** Владелец проекта
**Действие:** Отправляет команду `/rename` без параметров
**Результат:**
1. Бот показывает список доступных для управления проектов
2. Пользователь выбирает проект через inline-клавиатуру
3. Бот запрашивает новое название
4. Пользователь вводит новое название
5. Бот запрашивает подтверждение
6. Проект переименован после подтверждения

### 2. Права доступа

**Роли пользователей:**
- **Owner (Владелец)**: Может переименовывать проекты ✅
- **Watcher (Наблюдатель)**: Не может переименовывать проекты ❌
- **Participant (Участник)**: Не может переименовывать проекты ❌

**Ограничения:**
- Команда работает только в личных чатах с ботом
- Пользователь должен быть аутентифицирован в системе
- Проект должен быть активным (не в архиве)

### 3. Валидация и ограничения

**Название проекта:**
- **Минимальная длина**: 2 символа
- **Максимальная длина**: 255 символов
- **Уникальность**: Название должно быть уникальным в рамках системы
- **Формат**: Любые unicode-символы поддерживаются

**Slug проекта:**
- Автоматически генерируется из названия с помощью `Russian.translit`
- Обновляется автоматически при переименовании
- Используется для идентификации проекта в командах

### 4. Обработка ошибок

**Кейсы ошибок:**
1. **Проект не найден**: `Проект с slug 'xxx' не найден или недоступен`
2. **Нет прав**: `У вас нет прав для переименования этого проекта. Только владелец (owner) может переименовывать проекты.`
3. **Название занято**: `Проект с таким названием уже существует`
4. **Слишком короткое**: `Название проекта должно содержать минимум 2 символа`
5. **Слишком длинное**: `Название проекта не может быть длиннее 255 символов`
6. **Пустое название**: `Укажите новое название проекта...`

### 5. UX/UI требования

**Интерактивный режим:**
- Inline-клавиатура для выбора проектов
- Формат: `"Название проекта (slug)"`
- Контекстное меню для подтверждения действий
- Возможность отмены операции на любом этапе

**Сообщения об успехе:**
```
✅ Проект успешно переименован!
Старое название: Старое имя (old-slug)
Новое название: Новое имя (new-slug)
```

### 6. Технические требования

**Архитектура:**
- **Command**: `RenameCommand` - обработка Telegram-команды
- **Service**: `ProjectRenameService` - бизнес-логика
- **Config**: `RenameConfig` - константы и сообщения
- **Callbacks**: Обработка интерактивных действий

**Бизнес-процесс:**
1. Валидация входных данных
2. Проверка прав доступа пользователя
3. Проверка уникальности названия
4. Выполнение переименования в транзакции
5. Обновление slug через FriendlyId
6. Логирование операции

### 7. Интеграции

**Зависимости:**
- **Telegram Bot API**: Отправка сообщений и inline-клавиатур
- **TelegramSession**: Управление многошаговыми интеракциями
- **Authority**: Проверка прав доступа
- **FriendlyId**: Автоматическая генерация slug
- **Bugsnag**: Отслеживание ошибок

## Текущий статус

✅ **Команда полностью реализована** и готова к использованию

**Файлы реализации:**
- `app/controllers/telegram/commands/rename_command.rb` - обработка команды
- `app/services/project_rename_service.rb` - бизнес-логика
- `app/models/concerns/rename_config.rb` - конфигурация и сообщения

**Примеры использования:**
```bash
# Прямое переименование
/rename my-project "Новое название проекта"

# Интерактивный режим
/rename
```

## Заключение

Команда `/rename` уже **полностью реализована** в системе и соответствует всем лучшим практикам:

- ✅ Два режима использования (прямой и интерактивный)
- ✅ Правильная проверка прав доступа (только owner)
- ✅ Комплексная валидация данных
- ✅ Дружелюбный пользовательский интерфейс
- ✅ Обработка всех возможных ошибок
- ✅ Архитектурное разделение ответственности
- ✅ Поддержка русского языка

Спецификация описывает **текущую реализацию**, которая готова к использованию в production.