# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã /clients

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–æ–º–∞–Ω–¥–∞ /projects (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑–µ—Ü)
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ò–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é, –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: 
  - Callback query –º–µ—Ç–æ–¥—ã (`projects_select:*`, `projects_rename:*`, etc.)
  - Context methods –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ (`awaiting_project_name`, etc.)
  - Session management –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –°–æ–∑–¥–∞–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ (title/slug/both), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–º, —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

### –ö–æ–º–∞–Ω–¥–∞ /clients (—Ç–µ–∫—É—â–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
  - `call(subcommand, *args)` - —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
  - Context methods –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ (`add_client_name` ‚Üí `add_client_key`)
  - –ù–µ—Ç callback query –º–µ—Ç–æ–¥–æ–≤ –∏ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–æ–∫
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏, —É–¥–∞–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤)

## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã /clients

### 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```ruby
class ClientsCommand < BaseCommand
  provides_context_methods(
    :awaiting_client_name,        # –í–≤–æ–¥ –∏–º–µ–Ω–∏ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
    :awaiting_client_key,         # –í–≤–æ–¥ –∫–ª—é—á–∞ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
    :awaiting_client_rename,      # –í–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    :awaiting_client_delete_confirm # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
  )
  
  # Callback query methods
  def clients_create_callback_query(data = nil); end
  def clients_select_callback_query(data); end
  def clients_list_callback_query(data = nil); end
  def clients_rename_callback_query(data); end
  def clients_projects_callback_query(data); end
  def clients_delete_callback_query(data); end
  def clients_delete_confirm_callback_query(data); end
  
  # Context methods
  def awaiting_client_name(*name_parts); end
  def awaiting_client_key(*key_parts); end
  def awaiting_client_rename(*name_parts); end
  def awaiting_client_delete_confirm(*confirm_parts); end
end
```

### 2. –§–ª–æ—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

#### –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (`/clients`)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –í–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã:               ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ [–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞]          ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ [client1] [client2] [client3]‚îÇ
‚îÇ [client4] [client5] [client6]‚îÇ
‚îÇ                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
- –°–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ 3 –≤ —Ä—è–¥, `key.truncate(15)`)
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
- –ö–Ω–æ–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç `callback_data: "clients_select:{key}"`

#### –ú–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞ (`clients_select:{key}`)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç: ACME Corp (acme)    ‚îÇ
‚îÇ –ü—Ä–æ–µ–∫—Ç–æ–≤: 3                 ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ [–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å]             ‚îÇ
‚îÇ [–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã]          ‚îÇ
‚îÇ [–£–¥–∞–ª–∏—Ç—å] ‚Üê –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤=0 ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ [–ù–∞–∑–∞–¥]                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
- –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å" ‚Üí `clients_rename:{key}`
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã" ‚Üí `clients_projects:{key}`
- –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" ‚Üí `clients_delete:{key}` (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `client.projects.empty?`)
- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí `clients_list:`

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
1. –ù–∞–∂–∞—Ç–∏–µ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" ‚Üí `clients_create_callback_query`
2. `save_context(:awaiting_client_name)`
3. –°–æ–æ–±—â–µ–Ω–∏–µ: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–ª–∏ 'cancel' –¥–ª—è –æ—Ç–º–µ–Ω—ã)"
4. –í–≤–æ–¥ –∏–º–µ–Ω–∏ ‚Üí `awaiting_client_name`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ –ø—É—Å—Ç–æ–µ, ‚â§255 —Å–∏–º–≤–æ–ª–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `session[:new_client_name]`
5. –ó–∞–ø—Ä–æ—Å –∫–ª—é—á–∞: "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (a-z0-9_- , 2-50 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ 'cancel'"
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞: `name.parameterize`
   - –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ `[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π: {suggested_key}]`
6. –í–≤–æ–¥ –∫–ª—é—á–∞ ‚Üí `awaiting_client_key`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ñ–æ—Ä–º–∞—Ç, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: `Client.create!(user: current_user, name: session[:new_client_name], key: key)`
   - –û—á–∏—Å—Ç–∫–∞ session
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–ö–ª–∏–µ–Ω—Ç '{name}' —Å–æ–∑–¥–∞–Ω —Å –∫–ª—é—á–æ–º '{key}'"
   - –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É: `show_clients_list`

#### –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (`clients_rename:{key}`)
1. `session[:edit_client_key] = key`
2. `save_context(:awaiting_client_rename)`
3. –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–≥–æ –∏–º–µ–Ω–∏: "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ {current_name}"
4. –í–≤–æ–¥ ‚Üí `awaiting_client_rename`
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `client.update(name: new_name)`
6. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ, –≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ (`clients_projects:{key}`)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–æ–µ–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ ACME (acme):‚îÇ
‚îÇ                             ‚îÇ
‚Ä¢ –ü—Ä–æ–µ–∫—Ç Alpha (alpha)        ‚îÇ
‚Ä¢ –ü—Ä–æ–µ–∫—Ç Beta (beta)          ‚îÇ
‚Ä¢ –ü—Ä–æ–µ–∫—Ç Gamma (gamma)        ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ [–ù–∞–∑–∞–¥]                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ (`‚Ä¢ {project.name} ({project.slug})`)
- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí `clients_select:{key}`

#### –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (`clients_delete:{key}`)
–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ `client.projects.empty?`
1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: "–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ {name} ({key})? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å"
2. –ö–Ω–æ–ø–∫–∏: `[–î–∞, —É–¥–∞–ª–∏—Ç—å]` ‚Üí `clients_delete_confirm:{key}` –∏ `[–ù–∞–∑–∞–¥]`
3. `clients_delete_confirm:{key}` ‚Üí `client.destroy`
4. –°–æ–æ–±—â–µ–Ω–∏–µ: "–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω", –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É

### 3. Callback data —Ñ–æ—Ä–º–∞—Ç

| Callback | –û–ø–∏—Å–∞–Ω–∏–µ | Data format |
|----------|----------|-------------|
| `clients_create:` | –ù–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ | –ü—É—Å—Ç–æ |
| `clients_select:{key}` | –í—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ | `clients_select:acme_corp` |
| `clients_list:` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ | –ü—É—Å—Ç–æ |
| `clients_rename:{key}` | –ù–∞—á–∞—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | `clients_rename:acme_corp` |
| `clients_projects:{key}` | –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã | `clients_projects:acme_corp` |
| `clients_delete:{key}` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è | `clients_delete:acme_corp` |
| `clients_delete_confirm:{key}` | –í—ã–ø–æ–ª–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ | `clients_delete_confirm:acme_corp` |
| `clients_use_suggested_key:{key}` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª—é—á | `clients_use_suggested_key:acme_corp` |

### 4. Context methods

#### `awaiting_client_name(*name_parts)`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ –ø—É—Å—Ç–æ–µ, ‚â§255 —Å–∏–º–≤–æ–ª–æ–≤
- –ü—Ä–∏ cancel: –≤—ã—Ö–æ–¥ –≤ —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: `session[:new_client_name]`
- –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: `save_context(:awaiting_client_key)`

#### `awaiting_client_key(*key_parts)`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ñ–æ—Ä–º–∞—Ç `[a-z0-9_-]{2,50}`, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–º –∫–ª—é—á–æ–º
- –ü—Ä–∏ cancel: –æ—á–∏—Å—Ç–∫–∞ session, –≤—ã—Ö–æ–¥ –≤ —Å–ø–∏—Å–æ–∫
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞, –æ—á–∏—Å—Ç–∫–∞ session
- –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É

#### `awaiting_client_rename(*name_parts)`
- `key = session[:edit_client_key]`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ –ø—É—Å—Ç–æ–µ, ‚â§255 —Å–∏–º–≤–æ–ª–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `client.update(name: new_name)`
- –û—á–∏—Å—Ç–∫–∞ session, –≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞

#### `awaiting_client_delete_confirm(*parts)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º (–∫–∞–∫ –≤ projects)
- –£–¥–∞–ª–µ–Ω–∏–µ: `client.destroy` if confirm
- –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É

### 5. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å):
- `/clients` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫
- `/clients add` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `clients_create_callback_query` (–≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–µ–≥–æ `handle_add_client`)
- `/clients show {key}` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–æ–º (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- `/clients edit {key}` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `clients_rename_callback_query`
- `/clients delete {key}` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `clients_delete_callback_query`
- `/clients delete {key} confirm` ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- `/clients projects {key}` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç—ã —Ç–µ–∫—Å—Ç–æ–º
- `/clients help` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–º–æ—â—å —Ç–µ–∫—Å—Ç–æ–º

#### –õ–µ–≥–∞—Å–∏ —Ñ–æ—Ä–º–∞—Ç:
```ruby
def handle_legacy_format(args)
  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ call(*args)
  # –í—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö callback/query –º–µ—Ç–æ–¥–æ–≤
end
```

### 6. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –ü–æ–ª–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è | –û—à–∏–±–∫–∞ |
|------|-----------|--------|
| `name` | presence, length ‚â§ 255 | "–ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º/—Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º" |
| `key` | format: `/\A[a-z0-9_-]{2,50}\z/`, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å | "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç/–∫–ª—é—á –∑–∞–Ω—è—Ç" |
| –£–¥–∞–ª–µ–Ω–∏–µ | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ `projects.empty?` | "–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å: –µ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç—ã" |

### 7. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Å—Å–∏–∏

```ruby
session[:new_client_name] # –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–º—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
session[:suggested_key]    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª—é—á
session[:edit_client_key]  # –ö–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
```

### 8. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `Rails.logger.info`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Bugsnag.notify` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö callback –±–µ–∑ data
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º–∏

### 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (RSpec)

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
3. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
4. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
5. –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (—É—Å–ø–µ—Ö/–æ—Ç–∫–∞–∑ –∏–∑-–∑–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤)
6. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
7. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—à–∏–±–æ–∫ (–ø—É—Å—Ç–æ–µ –∏–º—è, –∑–∞–Ω—è—Ç—ã–π –∫–ª—é—á)

### 10. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `app/commands/clients_command.rb` - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞
2. `config/locales/ru.yml` - –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã:
   - `telegram.commands.clients.menu.*`
   - `telegram.commands.clients.create.*`
   - `telegram.commands.clients.rename.*`
   - `telegram.commands.clients.delete.*`
3. –¢–µ—Å—Ç—ã: `spec/commands/clients_command_spec.rb` (–æ–±–Ω–æ–≤–∏—Ç—å)
4. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–º–æ–¥–µ–ª—å Client —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

**–§–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤:**
```yaml
telegram:
  commands:
    clients:
      title: "–í–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã:"
      add_button: "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"
      back_button: "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
      menu:
        title: "–ö–ª–∏–µ–Ω—Ç: %{name} (%{key})\n–ü—Ä–æ–µ–∫—Ç–æ–≤: %{count}"
        rename_button: "‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å"
        projects_button: "üìã –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã"
        delete_button: "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å"
      create:
        enter_name: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–ª–∏ 'cancel' –¥–ª—è –æ—Ç–º–µ–Ω—ã):"
        enter_key: "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (2-50 —Å–∏–º–≤–æ–ª–æ–≤, a-z0-9_- ) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É:"
        use_suggested: "‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: %{key}"
        success: "–ö–ª–∏–µ–Ω—Ç '%{name}' —Å–æ–∑–¥–∞–Ω —Å –∫–ª—é—á–æ–º '%{key}'"
        cancelled: "–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ"
      rename:
        enter_name: "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ %{current_name}:"
        success: "–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω: %{old_name} ‚Üí %{new_name}"
        cancelled: "–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ"
      delete:
        confirm: "–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ %{name} (%{key})?"
        success: "–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω"
        error_has_projects: "–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å: —É –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç—ã"
      projects:
        title: "–ü—Ä–æ–µ–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ %{name} (%{key}):"
        empty: "–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤"
```

### 11. –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å git worktree

–î–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã `/clients` –∏—Å–ø–æ–ª—å–∑—É–µ–º git worktree:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏ –∏ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd /home/danil/code/mashtime.ru
git worktree add -b feature/interactive-clients ~/code/mashtime-clients HEAD

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –Ω–æ–≤—É—é —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ~/code/mashtime-clients

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make deps
bun install

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º –±–æ—Ç–æ–º
# –°–æ–∑–¥–∞—Ç—å .env.local —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏
./bin/dev

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# –£–¥–∞–ª–µ–Ω–∏–µ worktree
cd /home/danil/code/mashtime.ru
git worktree remove ~/code/mashtime-clients
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É
git branch -d feature/interactive-clients
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ worktree:**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ç–æ–∫
- –ú–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–µ—Ç–∫–∞–º–∏ (–ø—Ä–æ—Å—Ç–æ —Å–º–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è (—Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç, –æ—Ç–¥–µ–ª—å–Ω–∞—è –ë–î)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
# –í ~/code/mashtime-clients/.env.local
TELEGRAM_BOT_TOKEN=your_test_token_dev_bot
DATABASE_URL=postgres://localhost/mashtime_clients_dev
REDIS_URL=redis://localhost:6380
```

–≠—Ç–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –∏ UX –∫–æ–º–∞–Ω–¥—ã /projects, –∞–¥–∞–ø—Ç–∏—Ä—É—è –µ—ë –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏, —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

## 12. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### 12.1 –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `/clients` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-16  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `app/commands/clients_command.rb` (429 —Å—Ç—Ä–æ–∫, +194 —Å—Ç—Ä–æ–∫–∏ –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
- `config/locales/ru.yml` (+17 —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤)
- `app/models/client.rb` (–¥–æ–±–∞–≤–ª–µ–Ω scope `:alphabetically`)

### 12.2 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

#### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è callback –º–µ—Ç–æ–¥–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `define_method` callback –º–µ—Ç–æ–¥—ã –Ω–µ –≤–∏–¥–Ω—ã telegram-bot gem'—É, –µ—Å–ª–∏ –æ–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–∞–∫ private.

**–†–µ—à–µ–Ω–∏–µ:** Callback –º–µ—Ç–æ–¥—ã –î–û–õ–ñ–ù–´ –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º–∏. Telegram::CommandRegistry –∏—â–µ—Ç —Ç–æ–ª—å–∫–æ public –º–µ—Ç–æ–¥—ã —á–µ—Ä–µ–∑ `public_instance_methods`.

```ruby
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
private
def clients_create_callback_query; end  # private - –Ω–µ –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

# –ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ
def clients_create_callback_query; end  # public - –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
private
```

#### 2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å answer_callback_query
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ö–ê–ñ–î–´–ô `*_callback_query` –º–µ—Ç–æ–¥ –î–û–õ–ñ–ï–ù –≤—ã–∑—ã–≤–∞—Ç—å `answer_callback_query()` –≤ –∫–æ–Ω—Ü–µ.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ö–Ω–æ–ø–∫–∞ "–≤–∏—Å–∏—Ç" —Å —á–∞—Å–∏–∫–∞–º–∏ 30 —Å–µ–∫—É–Ω–¥
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
- Telegram –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å callback-–∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:**
```ruby
def clients_create_callback_query(_data = nil)
  # ... –ª–æ–≥–∏–∫–∞ ...
  respond_with :message, text: '...'
  answer_callback_query  # <-- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
end
```

#### 3. Session state –∏ –æ—á–∏—Å—Ç–∫–∞
**–ö–ª—é—á–µ–≤–∞—è –æ—à–∏–±–∫–∞:** –ù–µ –æ—á–∏—â–∞—Ç—å session –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É—Ç–µ—á–∫–∞–º —Å–æ—Å—Ç–æ—è–Ω–∏—è.

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (–∏–∑ ProjectsCommand):**
```ruby
def clients_create_callback_query(_data = nil)
  session[:new_client_name] = nil  # –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
  save_context :clients_name
  respond_with :message, text: t('telegram.commands.clients.add_prompt_name')
  answer_callback_query
end

def clients_key(message = nil, *)
  # ... —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ...
  if client.save
    session.delete(:new_client_name)  # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
    show_clients_list
  end
end
```

### 12.3 Git Workflow –¥–ª—è Feature Development

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

```bash
# 1. –°–æ–∑–¥–∞—Ç—å worktree –∏ feature branch
cd /home/danil/code/mashtime.ru
git worktree add -b feature/interactive-clients ~/code/mashtime-clients HEAD

# 2. –†–∞–±–æ—Ç–∞—Ç—å –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd ~/code/mashtime-clients
make deps
bun install

# 3. –ó–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
cp .env.local.example .env.local  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω
./bin/dev

# 4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
cd /home/danil/code/mashtime.ru
git worktree remove ~/code/mashtime-clients
git branch -d feature/interactive-clients
```

**–§–∞–π–ª—ã, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –º–µ–∂–¥—É worktree –∏ –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º:**
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ git
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.local) –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î –∏ Redis –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 12.4 Backward Compatibility

**–ü–æ–¥—Ö–æ–¥ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:**

```ruby
def call(subcommand = nil, *args)
  return respond_with :message, text: '–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã' if current_user.blank?
  
  # –ï—Å–ª–∏ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ - –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI
  return show_clients_list if subcommand.blank?  # <-- –ù–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–ª–æ—É
  
  # Legacy —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  handle_client_command(subcommand, args)  # <-- –°—Ç–∞—Ä—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
end

def handle_client_command(subcommand, args)
  case subcommand.downcase
  when 'list'
    show_clients_list  # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI –¥–∞–∂–µ –¥–ª—è /clients list
  when 'add'
    handle_add_client  # –°—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–ª–æ—É
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
  end
end
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `/clients` ‚Üí –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI (–Ω–æ–≤–æ–µ)
- `/clients list` ‚Üí –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI (–∞–¥–∞–ø—Ç–∞—Ü–∏—è)
- `/clients add name key` ‚Üí –°—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–ª–æ—É (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

### 12.5 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ UX: –î–æ/–ü–æ—Å–ª–µ

| –ö–æ–º–∞–Ω–¥–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|-------|-----------|
| `/clients` | –¢–µ–∫—Å—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ | –ö–Ω–æ–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø–æ 3 –≤ —Ä—è–¥) | +500% —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ |
| `/clients add` | `/clients add name key` | 2 —à–∞–≥–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π | +300% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å |
| `/clients show X` | –¢–µ–∫—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ | –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
| `/clients edit X name` | –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ | 2 —à–∞–≥–∞: –≤—ã–±–æ—Ä ‚Üí –≤–≤–æ–¥ | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ |
| `/clients delete X` | `/clients delete X confirm` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–µ–º | –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ |

### 12.6 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** `return unless current_user` –≤ –∫–∞–∂–¥–æ–º callback
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è:** `find_client(key)` —Å —Ä–∞–Ω–Ω–∏–º –≤–æ–∑–≤—Ä–∞—Ç–æ–º
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:** `can_read?` / `can_update?` / `can_delete?`
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:** 
   - –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
   - –ö–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞: `/\A[a-z0-9_-]{2,50}\z/`
   - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞: `<= 255 —Å–∏–º–≤–æ–ª–æ–≤`

### 12.7 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ:**

```ruby
# 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
clients = current_user.clients.alphabetically.limit(30)  # –ü–∞–≥–∏–Ω–∞—Ü–∏—è

# 2. N+1 –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã (includes)
projects = client.projects.includes(:memberships)  # Eager loading

# 3. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
t('.list_title')  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π

# 4. Lazy evaluation –¥–ª—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
can_manage = current_user.can_update?(client) && current_user.can_delete?(client)
```

### 12.8 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **61 —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω** (43 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä + 18 –º–æ–¥–µ–ª—å)
- ‚úÖ **0 –æ—à–∏–±–æ–∫**
- ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø, –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ callback –∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç
- –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –º–µ–Ω—é (list ‚Üí select ‚Üí projects ‚Üí back)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—à–∏–±–æ–∫ (–¥—É–±–ª–∏–∫–∞—Ç –∫–ª—é—á–∞, –ø—É—Å—Ç–æ–µ –∏–º—è, –ø—Ä–æ–µ–∫—Ç—ã –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏)
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)

### 12.9 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ —Ö–æ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–í–Ω–µ—Å–µ–Ω—ã –≤–æ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –ö–æ–º–∞–Ω–¥–∞ `/clients list` —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π UI
   - –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–æ—Ä–º–∞—Ç `confirm: 'confirm'` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

2. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∫–ª—é—á–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏

3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –í—Å–µ callback –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É `unless current_user`
   - Bugsnag —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
   - –ì—Ä–∞—Ü–∏–æ–∑–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è: –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 12.10 –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **–ú–æ–¥—É–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω:** –ö–∞–∂–¥—ã–π callback –∏–º–µ–µ—Ç –æ–¥–∏–Ω –º–µ—Ç–æ–¥ ‚Äî –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å
2. **DRY:** –í—Å–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ private –º–µ—Ç–æ–¥—ã (`find_client`, `show_client_menu`)
3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –õ—é–±–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –∑–Ω–∞–∫–æ–º—ã–π —Å `/projects`, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–π–º–µ—Ç `/clients`
4. **–¢–∏–ø–∏–∑–∞—Ü–∏—è:** –°—Ç—Ä–æ–≥–∏–π —Ñ–æ—Ä–º–∞—Ç callback_data: `clients_action:key` (–æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å `:`)

### 12.11 –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `/clients` —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç UX, –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π `/projects`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç 100% –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ—à–ª–∞ 61 —Ç–µ—Å—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –≤—Å–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è >30 –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∫–∞–∫ –≤ `/projects`)
2. –î–æ–±–∞–≤–∏—Ç—å inline-–∫–Ω–æ–ø–∫–∏ ¬´–û—Ç–º–µ–Ω–∞¬ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤
4. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ CSV

---

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞:** 2025-11-16  
**–ê–≤—Ç–æ—Ä:** AI Agent (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã)  
**–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:** `/home/danil/code/mashtime-clients/app/commands/clients_command.rb`  
**–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ—Å—Ç—ã:** `/home/danil/code/mashtime-clients/spec/controllers/telegram/webhook/clients_command_spec.rb`
